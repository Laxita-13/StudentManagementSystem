<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen p-6">

<div class="max-w-5xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">
        Student Management System
    </h1>

    <!-- ADD / UPDATE FORM -->
    <div class="mb-6">
        <h2 class="text-xl font-semibold mb-2">Add / Update Student</h2>

        <form id="studentForm" class="grid grid-cols-3 gap-4">
            <input type="hidden" id="studentId">

            <input type="text" id="name" placeholder="Name"
                   class="border p-2 rounded" required>

            <input type="number" id="age" placeholder="Age"
                   class="border p-2 rounded" required>

            <input type="email" id="email" placeholder="Email"
                   class="border p-2 rounded" required>

            <button type="submit"
                    class="col-span-3 bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                Save Student
            </button>
        </form>

        <p id="message" class="mt-3 font-medium"></p>
    </div>

    <!-- STUDENT TABLE -->
    <table class="w-full border-collapse border">
        <thead class="bg-blue-600 text-white">
        <tr>
            <th class="border p-2">ID</th>
            <th class="border p-2">Name</th>
            <th class="border p-2">Age</th>
            <th class="border p-2">Email</th>
            <th class="border p-2">Actions</th>
        </tr>
        </thead>

        <tbody id="studentTable" class="text-center">
        </tbody>
    </table>
</div>

<script>
    // âœ… If HTML is inside same Spring Boot project
    // OR if backend is separate:
    const API_BASE = "http://localhost:8080/students";

    const form = document.getElementById("studentForm");
    const table = document.getElementById("studentTable");
    const message = document.getElementById("message");

    form.addEventListener("submit", saveStudent);

    // LOAD ALL STUDENTS
    async function loadStudents() {
        const res = await fetch(`${API_BASE}/students`);
        const students = await res.json();

        table.innerHTML = "";
        students.forEach(s => {
            table.innerHTML += `
            <tr>
                <td class="border p-2">${s.id}</td>
                <td class="border p-2">${s.name}</td>
                <td class="border p-2">${s.age}</td>
                <td class="border p-2">${s.email}</td>
                <td class="border p-2 space-x-2">
                    <button onclick="editStudent('${s.id}', '${s.name}', ${s.age}, '${s.email}')"
                            class="bg-yellow-500 text-white px-2 py-1 rounded">
                        Edit
                    </button>
                    <button onclick="deleteStudent('${s.id}')"
                            class="bg-red-600 text-white px-2 py-1 rounded">
                        Delete
                    </button>
                </td>
            </tr>`;
        });
    }

    // ADD / UPDATE STUDENT
    async function saveStudent(e) {
        e.preventDefault();

        const id = document.getElementById("studentId").value;
        const student = {
            name: document.getElementById("name").value,
            age: document.getElementById("age").value,
            email: document.getElementById("email").value
        };

        let url = `/students`;
        let method = "POST";

        if (id) {
            url = `/students/${id}`;
            method = "PUT";
        }

        await fetch(url, {
            method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(student)
        });

        message.innerText = id
            ? "Student updated successfully!"
            : "Student added successfully!";
        message.className = "text-green-600";

        form.reset();
        document.getElementById("studentId").value = "";
        loadStudents();
    }

    // EDIT STUDENT
    function editStudent(id, nameVal, ageVal, emailVal) {
        document.getElementById("studentId").value = id;
        document.getElementById("name").value = nameVal;
        document.getElementById("age").value = ageVal;
        document.getElementById("email").value = emailVal;
    }

    // DELETE STUDENT
    async function deleteStudent(id) {
        if (!confirm("Are you sure?")) return;

        await fetch(`/students/${id}`, { method: "DELETE" });
        loadStudents();
    }

    loadStudents();
</script>


</body>
</html>